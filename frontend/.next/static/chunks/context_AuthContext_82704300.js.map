{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Acer/Desktop/cgdc-admin/frontend/context/AuthContext.js"],"sourcesContent":["\"use client\";\r\nimport { createContext, useContext, useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useRouter, usePathname } from \"next/navigation\";\r\n\r\nconst AuthContext = createContext({});\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n\r\n  // Configure axios defaults\r\n  axios.defaults.baseURL = \"http://localhost:5000\";\r\n  axios.defaults.withCredentials = true;\r\n\r\n  useEffect(() => {\r\n    checkAuth();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!loading) {\r\n      // Only redirect if we're sure about the auth state\r\n      if (pathname === \"/auth\" && user) {\r\n        router.push(\"/\");\r\n      } else if (!user && pathname !== \"/auth\") {\r\n        router.push(\"/auth\");\r\n      }\r\n    }\r\n  }, [user, loading, pathname]);\r\n\r\n  const checkAuth = async () => {\r\n    try {\r\n      const { data } = await axios.get(\"/auth/me\");\r\n      if (data.success) {\r\n        setUser(data.user);\r\n      } else {\r\n        setUser(null);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Auth check failed:\", error);\r\n      setUser(null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (username, password) => {\r\n    try {\r\n      const { data } = await axios.post(\"/auth/login\", { username, password });\r\n      if (data.success) {\r\n        setUser(data.user);\r\n        router.push(\"/\");\r\n        return { success: true };\r\n      }\r\n    } catch (error) {\r\n      return {\r\n        success: false,\r\n        message: error.response?.data?.message || \"Login failed\",\r\n      };\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await axios.post(\"/auth/logout\");\r\n      setUser(null);\r\n      router.push(\"/auth\");\r\n    } catch (error) {\r\n      console.error(\"Logout failed:\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, loading, login, logout }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error(\"useAuth must be used within an AuthProvider\");\r\n  }\r\n  return context;\r\n};\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;AAHA;;;;AAKA,MAAM,4BAAc,CAAA,GAAA,6JAAA,CAAA,gBAAa,AAAD,EAAE,CAAC;AAE5B,SAAS,aAAa,KAAY;QAAZ,EAAE,QAAQ,EAAE,GAAZ;;IAC3B,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACjC,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,WAAW,CAAA,GAAA,qIAAA,CAAA,cAAW,AAAD;IAE3B,2BAA2B;IAC3B,wIAAA,CAAA,UAAK,CAAC,QAAQ,CAAC,OAAO,GAAG;IACzB,wIAAA,CAAA,UAAK,CAAC,QAAQ,CAAC,eAAe,GAAG;IAEjC,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;kCAAE;YACR;QACF;iCAAG,EAAE;IAEL,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;kCAAE;YACR,IAAI,CAAC,SAAS;gBACZ,mDAAmD;gBACnD,IAAI,aAAa,WAAW,MAAM;oBAChC,OAAO,IAAI,CAAC;gBACd,OAAO,IAAI,CAAC,QAAQ,aAAa,SAAS;oBACxC,OAAO,IAAI,CAAC;gBACd;YACF;QACF;iCAAG;QAAC;QAAM;QAAS;KAAS;IAE5B,MAAM,YAAY;QAChB,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,wIAAA,CAAA,UAAK,CAAC,GAAG,CAAC;YACjC,IAAI,KAAK,OAAO,EAAE;gBAChB,QAAQ,KAAK,IAAI;YACnB,OAAO;gBACL,QAAQ;YACV;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,sBAAsB;YACpC,QAAQ;QACV,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,QAAQ,OAAO,UAAU;QAC7B,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,wIAAA,CAAA,UAAK,CAAC,IAAI,CAAC,eAAe;gBAAE;gBAAU;YAAS;YACtE,IAAI,KAAK,OAAO,EAAE;gBAChB,QAAQ,KAAK,IAAI;gBACjB,OAAO,IAAI,CAAC;gBACZ,OAAO;oBAAE,SAAS;gBAAK;YACzB;QACF,EAAE,OAAO,OAAO;gBAGH,sBAAA;YAFX,OAAO;gBACL,SAAS;gBACT,SAAS,EAAA,kBAAA,MAAM,QAAQ,cAAd,uCAAA,uBAAA,gBAAgB,IAAI,cAApB,2CAAA,qBAAsB,OAAO,KAAI;YAC5C;QACF;IACF;IAEA,MAAM,SAAS;QACb,IAAI;YACF,MAAM,wIAAA,CAAA,UAAK,CAAC,IAAI,CAAC;YACjB,QAAQ;YACR,OAAO,IAAI,CAAC;QACd,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kBAAkB;QAClC;IACF;IAEA,qBACE,6LAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAS;YAAO;QAAO;kBACzD;;;;;;AAGP;GAxEgB;;QAGC,qIAAA,CAAA,YAAS;QACP,qIAAA,CAAA,cAAW;;;KAJd;AA0ET,MAAM,UAAU;;IACrB,MAAM,UAAU,CAAA,GAAA,6JAAA,CAAA,aAAU,AAAD,EAAE;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANa","debugId":null}}]
}