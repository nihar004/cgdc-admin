{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Acer/Desktop/deploy%20-%20Copy/soetcgdc/frontend/context/AuthContext.js"],"sourcesContent":["\"use client\";\r\nimport { createContext, useContext, useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useRouter, usePathname } from \"next/navigation\";\r\n\r\nconst backendUrl = process.env.NEXT_PUBLIC_BACKEND_URL;\r\n\r\nconst AuthContext = createContext({});\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n\r\n  // Configure axios defaults\r\n  axios.defaults.baseURL = backendUrl;\r\n  axios.defaults.withCredentials = true;\r\n\r\n  useEffect(() => {\r\n    checkAuth();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!loading) {\r\n      // Only redirect if we're sure about the auth state\r\n      if (pathname === \"/auth\" && user) {\r\n        router.push(\"/\");\r\n\r\n      } else if (!user && pathname !== \"/auth\") {\r\n        router.push(\"/auth\");\r\n      }\r\n    }\r\n  }, [user, loading, pathname]);\r\n\r\n  const checkAuth = async () => {\r\n    try {\r\n      const { data } = await axios.get(\"/auth/me\");\r\n      if (data.success) {\r\n        setUser(data.user);\r\n      } else {\r\n        setUser(null);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Auth check failed:\", error);\r\n      setUser(null);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (username, password) => {\r\n    try {\r\n      const { data } = await axios.post(\"/auth/login\", { username, password });\r\n      if (data.success) {\r\n        setUser(data.user);\r\n        router.push(\"/\");\r\n        return { success: true };\r\n      }\r\n    } catch (error) {\r\n      return {\r\n        success: false,\r\n        message: error.response?.data?.message || \"Login failed\",\r\n      };\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      await axios.post(\"/auth/logout\");\r\n      setUser(null);\r\n      router.push(\"/auth\");\r\n    } catch (error) {\r\n      console.error(\"Logout failed:\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, loading, login, logout }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error(\"useAuth must be used within an AuthProvider\");\r\n  }\r\n  return context;\r\n};\r\n"],"names":[],"mappings":";;;;AAKmB;;AAJnB;AACA;AACA;;;AAHA;;;;AAKA,MAAM;AAEN,MAAM,4BAAc,CAAA,GAAA,6JAAA,CAAA,gBAAa,AAAD,EAAE,CAAC;AAE5B,SAAS,aAAa,KAAY;QAAZ,EAAE,QAAQ,EAAE,GAAZ;;IAC3B,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACjC,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,SAAS,CAAA,GAAA,qIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,WAAW,CAAA,GAAA,qIAAA,CAAA,cAAW,AAAD;IAE3B,2BAA2B;IAC3B,wIAAA,CAAA,UAAK,CAAC,QAAQ,CAAC,OAAO,GAAG;IACzB,wIAAA,CAAA,UAAK,CAAC,QAAQ,CAAC,eAAe,GAAG;IAEjC,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;kCAAE;YACR;QACF;iCAAG,EAAE;IAEL,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;kCAAE;YACR,IAAI,CAAC,SAAS;gBACZ,mDAAmD;gBACnD,IAAI,aAAa,WAAW,MAAM;oBAChC,OAAO,IAAI,CAAC;gBAEd,OAAO,IAAI,CAAC,QAAQ,aAAa,SAAS;oBACxC,OAAO,IAAI,CAAC;gBACd;YACF;QACF;iCAAG;QAAC;QAAM;QAAS;KAAS;IAE5B,MAAM,YAAY;QAChB,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,wIAAA,CAAA,UAAK,CAAC,GAAG,CAAC;YACjC,IAAI,KAAK,OAAO,EAAE;gBAChB,QAAQ,KAAK,IAAI;YACnB,OAAO;gBACL,QAAQ;YACV;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,sBAAsB;YACpC,QAAQ;QACV,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,QAAQ,OAAO,UAAU;QAC7B,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,wIAAA,CAAA,UAAK,CAAC,IAAI,CAAC,eAAe;gBAAE;gBAAU;YAAS;YACtE,IAAI,KAAK,OAAO,EAAE;gBAChB,QAAQ,KAAK,IAAI;gBACjB,OAAO,IAAI,CAAC;gBACZ,OAAO;oBAAE,SAAS;gBAAK;YACzB;QACF,EAAE,OAAO,OAAO;gBAGH,sBAAA;YAFX,OAAO;gBACL,SAAS;gBACT,SAAS,EAAA,kBAAA,MAAM,QAAQ,cAAd,uCAAA,uBAAA,gBAAgB,IAAI,cAApB,2CAAA,qBAAsB,OAAO,KAAI;YAC5C;QACF;IACF;IAEA,MAAM,SAAS;QACb,IAAI;YACF,MAAM,wIAAA,CAAA,UAAK,CAAC,IAAI,CAAC;YACjB,QAAQ;YACR,OAAO,IAAI,CAAC;QACd,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kBAAkB;QAClC;IACF;IAEA,qBACE,6LAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAS;YAAO;QAAO;kBACzD;;;;;;AAGP;GAzEgB;;QAGC,qIAAA,CAAA,YAAS;QACP,qIAAA,CAAA,cAAW;;;KAJd;AA2ET,MAAM,UAAU;;IACrB,MAAM,UAAU,CAAA,GAAA,6JAAA,CAAA,aAAU,AAAD,EAAE;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANa","debugId":null}},
    {"offset": {"line": 141, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Acer/Desktop/deploy%20-%20Copy/soetcgdc/frontend/context/BatchContext.js"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useState, useEffect, useContext } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useAuth } from \"./AuthContext\";\r\nconst backendUrl = process.env.NEXT_PUBLIC_BACKEND_URL;\r\n\r\nconst BatchContext = createContext();\r\n\r\nexport function BatchProvider({ children }) {\r\n  const [selectedBatch, setSelectedBatch] = useState(() => {\r\n    // Check if localStorage is available (client-side)\r\n    if (typeof window !== \"undefined\" && window.localStorage) {\r\n      const savedBatch = localStorage.getItem(\"selectedBatch\");\r\n      return savedBatch ? JSON.parse(savedBatch) : null;\r\n    }\r\n    return null;\r\n  });\r\n\r\n  const [batches, setBatches] = useState([]); // store all available batches\r\n  const { user, loading } = useAuth();\r\n\r\n  // Fetch batches only once when the app loads\r\n  useEffect(() => {\r\n    const controller = new AbortController();\r\n    async function fetchBatches() {\r\n      try {\r\n        const res = await axios.get(`${backendUrl}/batches`, {\r\n          signal: controller.signal,\r\n        });\r\n        const fetchedBatches = res.data;\r\n        setBatches(fetchedBatches);\r\n\r\n        // Check if localStorage is available before using it\r\n        if (typeof window !== \"undefined\" && window.localStorage) {\r\n          if (\r\n            !localStorage.getItem(\"selectedBatch\") &&\r\n            fetchedBatches.length > 0\r\n          ) {\r\n            setSelectedBatch(fetchedBatches[0]);\r\n          }\r\n        } else if (fetchedBatches.length > 0) {\r\n          // Fallback for SSR - just set the first batch\r\n          setSelectedBatch(fetchedBatches[0]);\r\n        }\r\n      } catch (error) {\r\n        if (axios.isCancel(error)) return; // request was cancelled\r\n        console.error(\"Error fetching batches:\", error);\r\n      }\r\n    }\r\n    fetchBatches();\r\n    return () => controller.abort();\r\n  }, [user, loading]);\r\n\r\n  // Whenever selectedBatch changes â†’ save to localStorage (client-side only)\r\n  useEffect(() => {\r\n    if (selectedBatch && typeof window !== \"undefined\" && window.localStorage) {\r\n      localStorage.setItem(\"selectedBatch\", JSON.stringify(selectedBatch));\r\n    }\r\n  }, [selectedBatch]);\r\n\r\n  const reloadBatches = async () => {\r\n    try {\r\n      const res = await axios.get(`${backendUrl}/batches`);\r\n      const fetchedBatches = res.data;\r\n      setBatches(fetchedBatches);\r\n\r\n      // If no batch is selected and we have batches, select the first one\r\n      if (!selectedBatch && fetchedBatches.length > 0) {\r\n        setSelectedBatch(fetchedBatches[0].year);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching batches:\", error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <BatchContext.Provider\r\n      value={{ selectedBatch, setSelectedBatch, batches, reloadBatches }}\r\n    >\r\n      {children}\r\n    </BatchContext.Provider>\r\n  );\r\n}\r\n\r\nexport const useBatchContext = () => {\r\n  const context = useContext(BatchContext);\r\n  if (!context) {\r\n    throw new Error(\"useBatchContext must be used within a BatchProvider\");\r\n  }\r\n  return context;\r\n};\r\n"],"names":[],"mappings":";;;;AAKmB;;AAHnB;AACA;AACA;;;AAJA;;;;AAKA,MAAM;AAEN,MAAM,6BAAe,CAAA,GAAA,6JAAA,CAAA,gBAAa,AAAD;AAE1B,SAAS,cAAc,KAAY;QAAZ,EAAE,QAAQ,EAAE,GAAZ;;IAC5B,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD;kCAAE;YACjD,mDAAmD;YACnD,IAAI,aAAkB,eAAe,OAAO,YAAY,EAAE;gBACxD,MAAM,aAAa,aAAa,OAAO,CAAC;gBACxC,OAAO,aAAa,KAAK,KAAK,CAAC,cAAc;YAC/C;YACA,OAAO;QACT;;IAEA,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE,EAAE,GAAG,8BAA8B;IAC1E,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,CAAA,GAAA,yHAAA,CAAA,UAAO,AAAD;IAEhC,6CAA6C;IAC7C,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;mCAAE;YACR,MAAM,aAAa,IAAI;YACvB,eAAe;gBACb,IAAI;oBACF,MAAM,MAAM,MAAM,wIAAA,CAAA,UAAK,CAAC,GAAG,CAAC,AAAC,GAAa,OAAX,YAAW,aAAW;wBACnD,QAAQ,WAAW,MAAM;oBAC3B;oBACA,MAAM,iBAAiB,IAAI,IAAI;oBAC/B,WAAW;oBAEX,qDAAqD;oBACrD,IAAI,aAAkB,eAAe,OAAO,YAAY,EAAE;wBACxD,IACE,CAAC,aAAa,OAAO,CAAC,oBACtB,eAAe,MAAM,GAAG,GACxB;4BACA,iBAAiB,cAAc,CAAC,EAAE;wBACpC;oBACF,OAAO,IAAI,eAAe,MAAM,GAAG,GAAG;wBACpC,8CAA8C;wBAC9C,iBAAiB,cAAc,CAAC,EAAE;oBACpC;gBACF,EAAE,OAAO,OAAO;oBACd,IAAI,wIAAA,CAAA,UAAK,CAAC,QAAQ,CAAC,QAAQ,QAAQ,wBAAwB;oBAC3D,QAAQ,KAAK,CAAC,2BAA2B;gBAC3C;YACF;YACA;YACA;2CAAO,IAAM,WAAW,KAAK;;QAC/B;kCAAG;QAAC;QAAM;KAAQ;IAElB,2EAA2E;IAC3E,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;mCAAE;YACR,IAAI,iBAAiB,aAAkB,eAAe,OAAO,YAAY,EAAE;gBACzE,aAAa,OAAO,CAAC,iBAAiB,KAAK,SAAS,CAAC;YACvD;QACF;kCAAG;QAAC;KAAc;IAElB,MAAM,gBAAgB;QACpB,IAAI;YACF,MAAM,MAAM,MAAM,wIAAA,CAAA,UAAK,CAAC,GAAG,CAAC,AAAC,GAAa,OAAX,YAAW;YAC1C,MAAM,iBAAiB,IAAI,IAAI;YAC/B,WAAW;YAEX,oEAAoE;YACpE,IAAI,CAAC,iBAAiB,eAAe,MAAM,GAAG,GAAG;gBAC/C,iBAAiB,cAAc,CAAC,EAAE,CAAC,IAAI;YACzC;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,2BAA2B;QAC3C;IACF;IAEA,qBACE,6LAAC,aAAa,QAAQ;QACpB,OAAO;YAAE;YAAe;YAAkB;YAAS;QAAc;kBAEhE;;;;;;AAGP;GA1EgB;;QAWY,yHAAA,CAAA,UAAO;;;KAXnB;AA4ET,MAAM,kBAAkB;;IAC7B,MAAM,UAAU,CAAA,GAAA,6JAAA,CAAA,aAAU,AAAD,EAAE;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANa","debugId":null}}]
}